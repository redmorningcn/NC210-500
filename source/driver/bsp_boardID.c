/*******************************************************************************
* Description  : 读设备编号
* Author       : 2018/4/12 星期四, by redmorningcn
*******************************************************************************/


/*******************************************************************************
* INCLUDES
*/
#include <bsp_boardID.h>


/*******************************************************************************
 * 				                    延时函数                                   *
 *******************************************************************************/
/*******************************************************************************
* 名    称： Delay_Nus()
* 功    能： 延时大概1us
* 入口参数： dly		延时参数，值越大，延时越久
* 出口参数： 无
* 作　 　者： 无名沈
* 创建日期： 2009-01-03
* 修    改：
* 修改日期：
*******************************************************************************/
OPTIMIZE_NONE void  Delay_Nus( INT32U  dly )
{
    /***********************************************
    * 描述：定时器初始化
    *       72000000次循环  = 6.9999999583333333333333333333333秒
    *       一次循环 = 6.9999999583333333333333333333333 / 72000000
    *       = 97.222221643518518518518518518519 ns
    *       ~= 0.1 us
    *       延时1us  dly  = 9
    *       dly = 0时，循环一次
    *
    while(dly--);
    *//***********************************************
    * 描述：定时器初始化
    *       1000000次循环  = 1027.7778611111111111111111111111ms
    *       平均一次循环 = 1.02777786111111111111111111111us
    *       dly = 1时，= 1.1111111111111111111111111111111us
    *       dly = 2时  = 2.1388888888888888888888888888889us
    *       dly 每增加1 增加-1.0277777777777777777777777777778us
    */
    INT32U  i;

    while(dly--) {
        for(i=0; i<7; i++);             // clk = 72000000 1027.7778611111111111111111111111
    }
}

/*******************************************************************************
* Description  : 端口初始化
* Author       : 2018/4/12 星期四, by redmorningcn
*******************************************************************************/
void Init_boardID( void )
{
    GPIO_InitTypeDef gpio_init;
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA | RCC_APB2Periph_AFIO, ENABLE);
    
    gpio_init.GPIO_Pin  =    GPIO_Pin_11
                            |GPIO_Pin_12;
    
    gpio_init.GPIO_Mode = GPIO_Mode_IPU;
    GPIO_Init(GPIOA, &gpio_init);
}

/*******************************************************************************
* Description  : 取电路板ID号
* Author       : 2018/4/12 星期四, by redmorningcn
*******************************************************************************/
uint8   get_boardID(void)
{
	uint8 id = 0;
	Delay_Nus(10);
	if(GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_11))
	{
		id |= 0x2;
	}
    
	if(GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_12))
	{
		id |= 0x01;
	}
    
	return id;
}

/*******************************************************************************
* 				end of file
*******************************************************************************/
